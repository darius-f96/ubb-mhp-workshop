<div class="main-page">
  <header class="header">
    <h1>Dropbox Clone</h1>
    <div class="user-info">
      <span class="welcome">Welcome, {{ userName() }}</span>
    </div>
  </header>

  <main class="content">
    <section class="upload-section">
      <h2>Upload File</h2>
      <div class="upload-container">
        <input
          type="file"
          (change)="onFileSelected($event)"
          id="fileInput"
          class="file-input"
          [disabled]="uploading()"
        />
        <label for="fileInput" class="file-label" [class.disabled]="uploading()">
          <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
          </svg>
          <span class="upload-text">
            {{ selectedFile() ? selectedFile()!.name : 'Choose a file to upload' }}
          </span>
        </label>

        @if (uploadError()) {
          <div class="alert alert-error">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
            </svg>
            <span>{{ uploadError() }}</span>
          </div>
        }

        @if (uploadSuccess()) {
          <div class="alert alert-success">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span>{{ uploadSuccess() }}</span>
          </div>
        }

        @if (selectedFile() && !uploading()) {
          <button
            class="upload-button"
            (click)="uploadFile()"
          >
            Upload File
          </button>
        }

        @if (uploading()) {
          <button class="upload-button uploading" disabled>
            <svg class="spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Uploading...
          </button>
        }
      </div>
    </section>

    <section class="files-section">
      <div class="files-header">
        <h2>Your Files</h2>
        <button class="refresh-button" (click)="loadFiles()" [disabled]="loadingFiles()">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" [class.spinning]="loadingFiles()">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
          </svg>
          Refresh
        </button>
      </div>

      @if (filesError()) {
        <div class="alert alert-error">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
          </svg>
          <span>{{ filesError() }}</span>
        </div>
      }

      @if (loadingFiles()) {
        <div class="loading-state">
          <svg class="spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <p>Loading your files...</p>
        </div>
      }

      @if (!loadingFiles() && files().length === 0 && !filesError()) {
        <div class="empty-state">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 13.5h3.86a2.25 2.25 0 012.012 1.244l.256.512a2.25 2.25 0 002.013 1.244h3.218a2.25 2.25 0 002.013-1.244l.256-.512a2.25 2.25 0 012.013-1.244h3.859m-19.5.338V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 00-2.15-1.588H6.911a2.25 2.25 0 00-2.15 1.588L2.35 13.177a2.25 2.25 0 00-.1.661z" />
          </svg>
          <p>No files yet</p>
          <span>Upload your first file to get started</span>
        </div>
      }

      @if (!loadingFiles() && files().length > 0) {
        <div class="files-list">
          @for (file of files(); track file.fileId) {
            <div class="file-item">
              <div class="file-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                </svg>
              </div>
              <div class="file-info">
                <h3>{{ file.fileName }}</h3>
                <div class="file-meta">
                  <span class="upload-date">{{ formatDate(file.uploadedDate) }}</span>
                  @if (isUrlExpired(file)) {
                    <span class="url-status expired">URL Expired</span>
                  } @else {
                    <span class="url-status valid">Valid until {{ formatDate(file.urlExpiration) }}</span>
                  }
                </div>
              </div>
              <div class="file-actions">
                @if (isUrlExpired(file)) {
                  <button class="action-button refresh" (click)="refreshFileUrl(file)">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                    </svg>
                    Refresh URL
                  </button>
                } @else {
                  <button class="action-button download" (click)="downloadFile(file)">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                    </svg>
                    Download
                  </button>
                }
                <button
                  class="action-button delete"
                  (click)="deleteFile(file)"
                  [disabled]="isDeleting(file.fileId)"
                >
                  @if (isDeleting(file.fileId)) {
                    <svg class="spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Deleting...
                  } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.108 1.022.169M19.228 5.79l-.32 9c-.073 2.063-1.784 3.71-3.848 3.71H8.94c-2.064 0-3.775-1.647-3.848-3.71l-.32-9m14.456 0a48.108 48.108 0 00-3.478-.397m3.478.397L5.772 5.79m0 0c.34-.061.68-.117 1.022-.169m0 0A48.11 48.11 0 0110.272 5.25m3.456 0c1.176.02 2.35.074 3.522.174" />
                    </svg>
                    Delete
                  }
                </button>
              </div>
            </div>
          }
        </div>
      }
    </section>
  </main>
</div>
